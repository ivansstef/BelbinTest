"""
Логіка тесту Белбіна
Містить питання, варіанти відповідей та розрахунок результатів
"""

from collections import defaultdict


class BelbinTest:
    """Клас для реалізації тесту Белбіна"""
    
    def __init__(self):
        """Ініціалізація тесту з питаннями та описами ролей"""
        self.role_descriptions = {
            "plant": {
                "name": "Генератор ідей (Plant)",
                "description": "Творча, винахідлива особа з хорошою уявою. Вирішує складні проблеми."
            },
            "resource_investigator": {
                "name": "Дослідник ресурсів (Resource Investigator)",
                "description": "Екстраверт, ентузіаст, комунікабельний. Досліджує можливості, розвиває контакти."
            },
            "coordinator": {
                "name": "Координатор (Coordinator)",
                "description": "Зрілий, впевнений у собі, хороший голова. Роз'яснює цілі, сприяє прийняттю рішень."
            },
            "shaper": {
                "name": "Формувач (Shaper)",
                "description": "Складний характер, динамічний, працює добре під тиском. Мужність долати перешкоди."
            },
            "monitor_evaluator": {
                "name": "Аналітик (Monitor Evaluator)",
                "description": "Розсудливий, стратегічний, проникливий. Бачить всі можливості, судить точно."
            },
            "teamworker": {
                "name": "Командний гравець (Teamworker)",
                "description": "Кооперативний, м'який, сприйнятливий, дипломатичний. Слухає, будує, запобігає суперечкам."
            },
            "implementer": {
                "name": "Виконавець (Implementer)",
                "description": "Дисциплінований, надійний, консервативний, ефективний. Перетворює ідеї в практичні дії."
            },
            "completer_finisher": {
                "name": "Фіналіст (Completer Finisher)",
                "description": "Старанний, сумлінний, турбується. Шукає помилки, доводить справу до кінця."
            },
            "specialist": {
                "name": "Спеціаліст (Specialist)",
                "description": "Самовіддана особа, цілеспрямована, має рідкісні навички та знання."
            }
        }
        
        self.questions = [
            {
                "question": "Що я можу внести в команду:",
                "options": [
                    {"text": "Я думаю, що можу швидко побачити й скористатися новими можливостями", "role": "resource_investigator"},
                    {"text": "Я можу добре працювати з людьми різного типу", "role": "teamworker"},
                    {"text": "Генерування ідей - моя природна здібність", "role": "plant"},
                    {"text": "Моя здатність залучати людей до роботи, коли я відчуваю, що щось варто зробити", "role": "shaper"},
                    {"text": "Моя спроможність виконувати роботу до кінця", "role": "completer_finisher"},
                    {"text": "Я готовий мати непопулярність, якщо це в кінцевому рахунку принесе користь", "role": "coordinator"},
                    {"text": "Я звичайно відчуваю, що є реалістичним і практичним", "role": "implementer"},
                    {"text": "Я можу запропонувати щось нове, коли команда потребує альтернативного підходу", "role": "monitor_evaluator"}
                ]
            },
            {
                "question": "Якщо у мене є недоліки в командній роботі, то можливо це тому, що:",
                "options": [
                    {"text": "Я не почуваюся комфортно на зборах, поки дискусія не стане більш структурованою", "role": "implementer"},
                    {"text": "Я схильний бути надто щедрим до людей, які мають слушну точку зору, але раніше її не висловлювали", "role": "teamworker"},
                    {"text": "У мене сильна тенденція говорити занадто багато, коли група обговорює нові ідеї", "role": "plant"},
                    {"text": "Мій об'єктивний погляд ускладнює для мене приєднання до ентузіазму колег", "role": "monitor_evaluator"},
                    {"text": "Іноді я здаюся нетерплячим щодо людей, які стають на заваді прогресу", "role": "shaper"},
                    {"text": "Мені важко розпочати роботу, якщо цілі нечіткі", "role": "coordinator"},
                    {"text": "Іноді я забуваю про час, коли захоплений новою ідеєю", "role": "resource_investigator"},
                    {"text": "Я схильний уникати очевидного, коли щось може піти не так", "role": "completer_finisher"}
                ]
            },
            {
                "question": "Коли я залучений до роботи з іншими людьми:",
                "options": [
                    {"text": "Я маю вплив на людей, не тиснучи на них", "role": "coordinator"},
                    {"text": "Моя пильність запобігає помилкам і недоглядам", "role": "completer_finisher"},
                    {"text": "Я готовий наполягати на дії, щоб збори не втратили час і не збились з курсу", "role": "shaper"},
                    {"text": "Можна розраховувати на те, що я запропоную щось оригінальне", "role": "plant"},
                    {"text": "Я завжди готовий підтримати хорошу пропозицію в загальних інтересах", "role": "teamworker"},
                    {"text": "Я зацікавлений знайти останні ідеї та розробки", "role": "resource_investigator"},
                    {"text": "Я вважаю, що моя здатність виносити рішення цінується іншими", "role": "monitor_evaluator"},
                    {"text": "На мене можна покластися в організації роботи", "role": "implementer"}
                ]
            },
            {
                "question": "Мій характерний підхід до групової роботи полягає в тому, що:",
                "options": [
                    {"text": "Я маю особливий інтерес до пізнання своїх колег краще", "role": "teamworker"},
                    {"text": "Я не боюся кинути виклик поглядам інших або утримати позицію меншості", "role": "shaper"},
                    {"text": "Зазвичай я можу знайти лінію аргументу для спростування необґрунтованих пропозицій", "role": "monitor_evaluator"},
                    {"text": "Я думаю, що маю талант швидко втілювати плани в дію", "role": "implementer"},
                    {"text": "У мене репутація людини, яка прямо говорить те, що думає", "role": "coordinator"},
                    {"text": "Я можу принести щось незвичне до групової дискусії", "role": "plant"},
                    {"text": "Я слухаю інших і не висловлюю власних поглядів поспіхом", "role": "resource_investigator"},
                    {"text": "Я уникаю недбалого підходу і дбаю, щоб робота була зроблена правильно", "role": "completer_finisher"}
                ]
            },
            {
                "question": "Я отримую задоволення від своєї роботи, тому що:",
                "options": [
                    {"text": "Мені подобається аналізувати ситуації та зважувати можливі варіанти дій", "role": "monitor_evaluator"},
                    {"text": "Мені цікаво знаходити практичні рішення проблем", "role": "implementer"},
                    {"text": "Мені подобається відчувати, що я підтримую дух співпраці", "role": "teamworker"},
                    {"text": "Я можу мати сильний вплив на рішення", "role": "shaper"},
                    {"text": "Я можу зустрічати людей, які можуть запропонувати щось нове", "role": "resource_investigator"},
                    {"text": "Я можу змусити людей домовитися про необхідну дію", "role": "coordinator"},
                    {"text": "Я відчуваю себе у своїй стихії, коли можу приділити завданню всю свою увагу", "role": "completer_finisher"},
                    {"text": "Мені подобається знаходити сферу, що розширює мою уяву", "role": "plant"}
                ]
            },
            {
                "question": "Якщо мені раптово дали складне завдання з обмеженим часом і незнайомими людьми:",
                "options": [
                    {"text": "Я би відійшов у куток, щоб придумати вихід із ситуації", "role": "plant"},
                    {"text": "Я би був готовий працювати з людиною, яка показала найпозитивніший підхід", "role": "teamworker"},
                    {"text": "Я би знайшов способи скорочення розміру завдання, встановивши, що різні люди можуть найкраще внести", "role": "coordinator"},
                    {"text": "Моя природна невгамовність допомогла б підтримати всіх у нас на завданні", "role": "shaper"},
                    {"text": "Я вважаю, що зберіг би хладнокровність і здатність мислити прямо", "role": "monitor_evaluator"},
                    {"text": "Я би дотримувався цілей, незважаючи на тиск", "role": "implementer"},
                    {"text": "Я би був готовий взяти на себе провідну роль, якщо відчув, що група не прогресує", "role": "resource_investigator"},
                    {"text": "Я би організував роботу найефективнішим способом", "role": "completer_finisher"}
                ]
            },
            {
                "question": "Стосовно проблем, які у мене виникають, працюючи в групах:",
                "options": [
                    {"text": "Я схильний показувати своє незадоволення тими, хто стоїть на заваді прогресу", "role": "shaper"},
                    {"text": "Інші критикують мене за те, що я занадто аналітичний і недостатньо інтуїтивний", "role": "monitor_evaluator"},
                    {"text": "Моє бажання переконатися, що робота виконується правильно, не завжди популярне", "role": "completer_finisher"},
                    {"text": "Я маю тенденцію нудьгувати досить швидко і покладаюся на одного-двох стимулюючих членів групи", "role": "plant"},
                    {"text": "Мені важко розпочинати, якщо я не впевнений у цілях", "role": "implementer"},
                    {"text": "Іноді я поганий у поясненні та розробці складних ідей, які спадають мені на думку", "role": "resource_investigator"},
                    {"text": "Я свідомий того, що вимагаю від інших того, що сам не можу зробити", "role": "coordinator"},
                    {"text": "Я вагаюся висловити свою думку, коли відчуваю серйозну опозицію", "role": "teamworker"}
                ]
            }
        ]
    
    def calculate_results(self, answers):
        """Розраховує результати тесту на основі відповідей"""
        # Підрахунок балів для кожної ролі
        role_scores = defaultdict(int)
        
        for question_index, selected_role in answers.items():
            role_scores[selected_role] += 1
        
        # Переконуємось, що всі ролі присутні (навіть з нульовим результатом)
        for role in self.role_descriptions.keys():
            if role not in role_scores:
                role_scores[role] = 0
        
        return dict(role_scores)
    
    def get_primary_roles(self, results, top_n=3):
        """Повертає топ-N найбільш виражених ролей"""
        sorted_results = sorted(results.items(), key=lambda x: x[1], reverse=True)
        return sorted_results[:top_n]
    
    def get_role_interpretation(self, results):
        """Повертає інтерпретацію результатів"""
        primary_roles = self.get_primary_roles(results, 2)
        
        interpretation = "ІНТЕРПРЕТАЦІЯ РЕЗУЛЬТАТІВ:\n\n"
        
        if primary_roles[0][1] > 0:
            main_role = primary_roles[0][0]
            interpretation += f"Ваша основна командна роль: {self.role_descriptions[main_role]['name']}\n"
            interpretation += f"{self.role_descriptions[main_role]['description']}\n\n"
            
            if len(primary_roles) > 1 and primary_roles[1][1] > 0:
                secondary_role = primary_roles[1][0]
                interpretation += f"Ваша додаткова роль: {self.role_descriptions[secondary_role]['name']}\n"
                interpretation += f"{self.role_descriptions[secondary_role]['description']}\n\n"
        
        interpretation += "РЕКОМЕНДАЦІЇ:\n"
        interpretation += "- Використовуйте свої сильні сторони у командній роботі\n"
        interpretation += "- Будьте свідомі своїх обмежень\n"
        interpretation += "- Шукайте можливості для розвитку інших ролей\n"
        interpretation += "- Цінуйте різноманітність ролей у своїй команді\n"
        
        return interpretation